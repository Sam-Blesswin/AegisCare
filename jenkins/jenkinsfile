pipeline {
  agent any

  environment {
    DOCKER_IMAGE = 'aegiscare'
    REGISTRY = 'local'
    API_KEY = 'insecure-demo-apikey'  // Hardcoded for vuln-demo
  }

  stages {
    stage('Build') {
      steps {
        echo "Building Docker image..."
        sh 'docker build -t $DOCKER_IMAGE ./backend'
      }
    }

    stage('Push') {
      steps {
        echo "Pushing to registry (simulated)..."
        sh 'docker images | grep $DOCKER_IMAGE'
      }
    }
  }

  post {
    always {
      echo "Build completed at ${new Date()}"
    }
  }
}
